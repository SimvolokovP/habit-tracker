import { Cell, Divider, List } from "@telegram-apps/telegram-ui";
import { useEffect, useRef } from "react";
import useItemActionsList from "../../store/useItemActionsList";

const ItemActionsList = () => {
  const { closeMenu, openItemId } = useItemActionsList();
  const actionsListRef = useRef<HTMLDivElement | null>(null);

  useEffect(() => {
    const handleClickOutside = (event: MouseEvent) => {
      const target = event.target as HTMLElement;

      if (actionsListRef.current && !actionsListRef.current.contains(target)) {
        closeMenu();
      }
    };

    document.addEventListener("click", handleClickOutside);

    return () => {
      document.removeEventListener("click", handleClickOutside);
    };
  }, [closeMenu]);

  const handleCompletedClick = () => {
    console.log("Completed" + openItemId);
  };

  return (
    <div ref={actionsListRef}>
      <List className="actions__list">
        <div>
          <Cell
            onClick={handleCompletedClick}
            className="actions__item actions__item--first"
          >
            <div className="flex gap-[16px] items-center">
              <svg
                width="28"
                height="28"
                viewBox="0 0 28 28"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  fillRule="evenodd"
                  clipRule="evenodd"
                  d="M24.6636 6.20997C25.0567 6.58938 25.0678 7.21567 24.6884 7.60881L11.3863 21.3921C11.1999 21.5852 10.943 21.6943 10.6745 21.6943C10.406 21.6943 10.1491 21.5852 9.96265 21.3921L3.31162 14.5004C2.9322 14.1073 2.94333 13.481 3.33647 13.1016C3.72961 12.7222 4.3559 12.7333 4.73531 13.1264L10.6745 19.2805L23.2647 6.23482C23.6441 5.84168 24.2704 5.83055 24.6636 6.20997Z"
                  fill="#31D158"
                />
              </svg>
              <div>Completed</div>
            </div>
          </Cell>
          <Divider />
          <Cell className="actions__list--item">
            <div className="flex gap-[16px] items-center">
              <svg
                width="28"
                height="28"
                viewBox="0 0 28 28"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M6.86612 21.0082L21.0083 6.86611M24 14C24 19.5228 19.5228 24 14 24C8.47715 24 4 19.5228 4 14C4 8.47715 8.47715 4 14 4C19.5228 4 24 8.47715 24 14Z"
                  stroke="var(--color-apptext)"
                  strokeWidth="2"
                />
              </svg>

              <div>Not Completed</div>
            </div>
          </Cell>
          <Divider />
          <Cell className="actions__list--item">
            <div className="flex gap-[16px] items-center">
              <svg
                width="28"
                height="28"
                viewBox="0 0 28 28"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  fillRule="evenodd"
                  clipRule="evenodd"
                  d="M5.30556 5.23137C5.69348 4.83827 6.32664 4.83407 6.71974 5.222L14.0019 12.4083L21.284 5.222C21.6771 4.83407 22.3103 4.83827 22.6982 5.23137C23.0861 5.62448 23.0819 6.25763 22.6888 6.64555L15.4256 13.8132L22.6888 20.9808C23.0819 21.3688 23.0861 22.0019 22.6982 22.395C22.3103 22.7881 21.6771 22.7923 21.284 22.4044L14.0019 15.2181L6.71974 22.4044C6.32664 22.7923 5.69348 22.7881 5.30556 22.395C4.91763 22.0019 4.92183 21.3688 5.31493 20.9808L12.5782 13.8132L5.31493 6.64555C4.92183 6.25763 4.91763 5.62448 5.30556 5.23137Z"
                  fill="var(--color-apptext)"
                />
              </svg>

              <div>Cancel</div>
            </div>
          </Cell>
          <Divider />
          <Cell className="actions__list--item">
            <div className="flex gap-[16px] items-center">
              <svg
                width="28"
                height="28"
                viewBox="0 0 28 28"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  fillRule="evenodd"
                  clipRule="evenodd"
                  d="M14.3412 4.2612C13.9574 4.6501 13.9616 5.27646 14.3504 5.66024L20.3163 11.5476H15.639C13.3988 11.5476 11.6287 11.5476 10.23 11.7139C8.79568 11.8845 7.62282 12.242 6.64683 13.0503C6.33207 13.311 6.04245 13.6006 5.78177 13.9154C4.97345 14.8914 4.61599 16.0642 4.44537 17.4986C4.279 18.8973 4.27901 20.6673 4.27903 22.9075V22.9728C4.27903 23.5191 4.72194 23.962 5.26831 23.962C5.81468 23.962 6.2576 23.5191 6.2576 22.9728C6.2576 20.6529 6.25924 19.0005 6.4101 17.7323C6.55832 16.4862 6.83854 15.7413 7.30559 15.1774C7.48738 14.9579 7.68936 14.7559 7.90886 14.5741C8.47278 14.1071 9.21762 13.8269 10.4637 13.6787C11.732 13.5278 13.3843 13.5262 15.7042 13.5262H20.3164L15.0488 18.7243C14.6599 19.1081 14.6558 19.7345 15.0395 20.1234C15.4233 20.5123 16.0497 20.5164 16.4386 20.1326L23.4221 13.241C23.6105 13.0551 23.7166 12.8015 23.7166 12.5369C23.7166 12.2722 23.6105 12.0186 23.4221 11.8327L15.7402 4.25193C15.3513 3.86816 14.7249 3.87231 14.3412 4.2612Z"
                  fill="var(--color-apptext)"
                />
              </svg>

              <div>Skip</div>
            </div>
          </Cell>
          <Divider />
          <Cell className="actions__list--item">
            <div className="flex gap-[16px] items-center">
              <svg
                width="28"
                height="28"
                viewBox="0 0 28 28"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  fillRule="evenodd"
                  clipRule="evenodd"
                  d="M18.9182 3.39398C19.132 3.36998 19.3478 3.36998 19.5615 3.39398C20.1355 3.45843 20.6024 3.72417 21.0334 4.06153C21.44 4.37982 21.8915 4.8254 22.4211 5.34809L22.494 5.41996C23.0368 5.95561 23.4989 6.41156 23.8289 6.82283C24.1782 7.25827 24.4543 7.73178 24.5211 8.31694C24.546 8.53429 24.546 8.75377 24.5211 8.97112C24.4543 9.55628 24.1782 10.0298 23.8289 10.4652C23.4989 10.8765 23.0368 11.3324 22.494 11.8681L10.4774 23.7264C10.4501 23.7534 10.4231 23.7801 10.3963 23.8066C9.97803 24.2203 9.62243 24.572 9.17039 24.784C9.085 24.824 8.99769 24.8598 8.90879 24.8913C8.43815 25.058 7.93799 25.0574 7.3497 25.0567C7.31203 25.0567 7.27401 25.0566 7.23561 25.0566H7.11648C6.37865 25.0567 5.75011 25.0567 5.24173 24.999C4.7035 24.9379 4.189 24.8026 3.73756 24.4529C3.54543 24.304 3.37289 24.1315 3.22405 23.9393C2.87434 23.4879 2.73902 22.9734 2.67793 22.4352C2.62022 21.9268 2.62025 21.2982 2.62028 20.5604L2.62028 20.5103C2.62028 20.4727 2.62024 20.4355 2.6202 20.3987C2.61956 19.8236 2.61901 19.3349 2.778 18.8743C2.81794 18.7585 2.86521 18.6455 2.91953 18.5357C3.13575 18.099 3.48396 17.7562 3.89374 17.3527C3.91999 17.3268 3.9465 17.3007 3.97325 17.2743L16.0586 5.34806C16.5883 4.82538 17.0397 4.37981 17.4464 4.06153C17.8774 3.72417 18.3442 3.45843 18.9182 3.39398ZM19.3607 5.18274C19.2804 5.17372 19.1994 5.17372 19.1191 5.18274C19.0106 5.19492 18.8559 5.24405 18.5558 5.47896C18.2405 5.72574 17.8626 6.09679 17.2868 6.66493L16.5913 7.35131L20.5498 11.2577L21.1929 10.6231C21.7825 10.0413 22.1683 9.65859 22.4249 9.33877C22.6695 9.03387 22.7202 8.87662 22.7328 8.76687C22.7421 8.68524 22.7421 8.60282 22.7328 8.52119C22.7202 8.41144 22.6695 8.25419 22.4249 7.94929C22.1683 7.62947 21.7825 7.24678 21.1929 6.66493C20.6172 6.09679 20.2392 5.72574 19.9239 5.47896C19.6238 5.24405 19.4692 5.19492 19.3607 5.18274ZM19.2685 12.5222L15.31 8.61575L5.23757 18.5555C4.70598 19.0801 4.59764 19.2031 4.53267 19.3344C4.51227 19.3756 4.49451 19.418 4.47951 19.4615C4.43174 19.5999 4.42028 19.7634 4.42028 20.5103C4.42028 21.312 4.42164 21.8374 4.46645 22.2322C4.50917 22.6086 4.58148 22.7524 4.64703 22.837C4.70293 22.9092 4.76773 22.974 4.83989 23.0299C4.92451 23.0954 5.06834 23.1677 5.44473 23.2105C5.8395 23.2553 6.36491 23.2566 7.16661 23.2566H7.23561C7.9996 23.2566 8.16651 23.2446 8.30797 23.1945C8.34136 23.1827 8.37415 23.1693 8.40622 23.1542C8.54208 23.0905 8.66932 22.9818 9.21311 22.4452L19.2685 12.5222Z"
                  fill="var(--color-apptext)"
                />
              </svg>

              <div>Edit</div>
            </div>
          </Cell>
          <Divider />
          <Cell className="actions__item actions__item--last">
            <div className="flex gap-[16px] items-center">
              <svg
                width="28"
                height="28"
                viewBox="0 0 28 28"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  fillRule="evenodd"
                  clipRule="evenodd"
                  d="M13.8185 2.48459C13.8671 2.48464 13.9164 2.48469 13.9662 2.48469C14.0161 2.48469 14.0653 2.48464 14.114 2.48459C14.8432 2.48386 15.4359 2.48326 15.9448 2.65189C16.884 2.96315 17.6353 3.68341 17.9646 4.61745C18.0837 4.95508 18.1231 5.32952 18.1358 5.74914H22.9451C23.4915 5.74914 23.9344 6.19206 23.9344 6.73843C23.9344 7.2848 23.4915 7.72772 22.9451 7.72772H4.98733C4.44097 7.72772 3.99805 7.2848 3.99805 6.73843C3.99805 6.19206 4.44097 5.74914 4.98733 5.74914H9.79661C9.80939 5.32952 9.84879 4.95508 9.96782 4.61745C10.2971 3.68342 11.0484 2.96315 11.9877 2.65189C12.4965 2.48326 13.0893 2.48386 13.8185 2.48459ZM11.7776 5.74914H16.1548C16.146 5.47182 16.1288 5.36089 16.0986 5.27532C15.9787 4.93501 15.6975 4.65434 15.3224 4.53002C15.1592 4.47594 14.9213 4.46326 13.9662 4.46326C13.0112 4.46326 12.7732 4.47594 12.6101 4.53002C12.2349 4.65434 11.9538 4.93501 11.8338 5.27532C11.8037 5.36089 11.7865 5.47182 11.7776 5.74914ZM6.54936 9.02109C7.09159 8.95398 7.58556 9.33914 7.65267 9.88137L8.74296 18.6902C8.89024 19.8801 8.99203 20.6905 9.13936 21.3039C9.28126 21.8947 9.44254 22.1951 9.64371 22.4085C9.75464 22.5261 9.87841 22.6326 10.0132 22.7262C10.2621 22.8989 10.6001 23.0216 11.2325 23.0889C11.8842 23.1583 12.732 23.1596 13.9662 23.1596C15.2004 23.1596 16.0483 23.1583 16.7 23.0889C17.3323 23.0216 17.6703 22.8989 17.9193 22.7262C18.054 22.6326 18.1778 22.5261 18.2887 22.4085C18.4899 22.1951 18.6512 21.8947 18.7931 21.3039C18.9404 20.6905 19.0422 19.8801 19.1895 18.6902L20.2798 9.88137C20.3469 9.33914 20.8409 8.95398 21.3831 9.02109C21.9253 9.0882 22.3105 9.58217 22.2434 10.1244L21.1461 18.9898C21.0076 20.1091 20.8935 21.0311 20.7169 21.766C20.532 22.5359 20.2564 23.2059 19.7282 23.7659C19.5224 23.9841 19.2942 24.1803 19.0473 24.3517C18.4174 24.7888 17.7095 24.9712 16.9094 25.0563C16.1407 25.1382 15.1872 25.1382 14.0208 25.1381H13.9117C12.7453 25.1382 11.7918 25.1382 11.023 25.0563C10.2229 24.9712 9.5151 24.7888 8.88512 24.3517C8.63827 24.1803 8.41002 23.9841 8.20428 23.7659C7.67609 23.2059 7.40044 22.5359 7.21551 21.766C7.03898 21.031 6.92488 20.109 6.78637 18.9898L5.68908 10.1244C5.62197 9.58217 6.00713 9.0882 6.54936 9.02109Z"
                  fill="#DF2C2C"
                />
              </svg>

              <div>Delete</div>
            </div>
          </Cell>
        </div>
      </List>
    </div>
  );
};

export default ItemActionsList;
